# üìÑ API –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è ‚Äî –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–µ—Ä–≤–∏—Å

–≠—Ç–æ—Ç —Å–µ—Ä–≤–∏—Å –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç REST API –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —Å–∏—Å—Ç–µ–º—ã –∏–∑ —Ñ–∞–π–ª–∞ `config.yaml`.

## üåê –ë–∞–∑–æ–≤—ã–π URL
```
http://<host>:<port>
```

---

## üîë –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã API

### 1. –ü–æ–ª—É—á–∏—Ç—å –≤—Å—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
**`GET /config`**

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤–µ—Å—å –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–æ–Ω–Ω—ã–π —Ñ–∞–π–ª –≤ –≤–∏–¥–µ JSON.

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```bash
curl http://localhost:8000/config
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "system": {
    "model": "yolov5n",
    "rtsp_stream_url": "rtsp://camera/stream",
    "alarm_host": "192.168.0.100",
    "alarm_port": 9000
  },
  "cigarette": {
    "duration": 3.0,
    "threshold": 0.5
  }
}
```

---

### 2. –ü–æ–ª—É—á–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞
**`GET /config/{section}`**

–í–æ–∑–≤—Ä–∞—â–∞–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —É–∫–∞–∑–∞–Ω–Ω–æ–≥–æ —Ä–∞–∑–¥–µ–ª–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.

**–ü–∞—Ä–∞–º–µ—Ç—Ä—ã –ø—É—Ç–∏**
- `section` ‚Äî –∏–º—è —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `system`, `cigarette`, `phone`)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```bash
curl http://localhost:8000/config/system
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "model": "yolov5n",
  "rtsp_stream_url": "rtsp://camera/stream",
  "alarm_host": "192.168.0.100",
  "alarm_port": 9000
}
```

---

### 3. –û–±–Ω–æ–≤–∏—Ç—å –ø–∞—Ä–∞–º–µ—Ç—Ä –≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
**`PATCH /config`**

–ò–∑–º–µ–Ω—è–µ—Ç –∑–Ω–∞—á–µ–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è –≤ `config.yaml`.

**–¢–µ–ª–æ –∑–∞–ø—Ä–æ—Å–∞**
```json
{
  "section": "system",
  "key": "alarm_port",
  "value": 9100
}
```

**–û–ø–∏—Å–∞–Ω–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤**
- `section` ‚Äî —Ä–∞–∑–¥–µ–ª –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ (`system`, `cigarette`, `phone`, –∏ —Ç.–¥.)
- `key` ‚Äî –∫–ª—é—á –≤–Ω—É—Ç—Ä–∏ —Ä–∞–∑–¥–µ–ª–∞ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `duration`, `threshold`)
- `value` ‚Äî –Ω–æ–≤–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ (—á–∏—Å–ª–æ –∏–ª–∏ —Å—Ç—Ä–æ–∫–∞)

**–ü—Ä–∏–º–µ—Ä –∑–∞–ø—Ä–æ—Å–∞**
```bash
curl -X PATCH http://localhost:8000/config \
-H "Content-Type: application/json" \
-d '{"section": "system", "key": "alarm_port", "value": 9100}'
```

**–ü—Ä–∏–º–µ—Ä –æ—Ç–≤–µ—Ç–∞**
```json
{
  "status": "ok",
  "updated": {
    "section": "system",
    "key": "alarm_port",
    "value": 9100
  }
}
```

---

## üìã –¢–∞–±–ª–∏—Ü–∞ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

| –†–∞–∑–¥–µ–ª | –ö–ª—é—á | –û–ø–∏—Å–∞–Ω–∏–µ |
|--------|------|----------|
| **system** | `model` | –ú–æ–¥–µ–ª—å YOLO |
|  | `rtsp_stream_url` | URL –∏—Å—Ö–æ–¥–Ω–æ–≥–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ |
|  | `shape_predictor` | –ü—É—Ç—å –∫ —Ñ–∞–π–ª—É shape_predictor |
|  | `alarm_host` | –•–æ—Å—Ç –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Ç—Ä–µ–≤–æ–≥ |
|  | `alarm_port` | –ü–æ—Ä—Ç –¥–ª—è —Ç—Ä–µ–≤–æ–≥ |
|  | `target_host` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π —Ö–æ—Å—Ç |
|  | `target_port` | –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–π –ø–æ—Ä—Ç |
|  | `output_stream_url` | URL –æ–±—Ä–∞–±–æ—Ç–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ–ø–æ—Ç–æ–∫–∞ |
| **cigarette** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ñ–∏–∫—Å–∞—Ü–∏–∏ –∫—É—Ä–µ–Ω–∏—è (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∫—É—Ä–µ–Ω–∏—è |
| **closed_eyes** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑ (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑ |
| **closed_eyes_duration** | `tracking_window` | –û–∫–Ω–æ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –≤—Ä–µ–º–µ–Ω–∏ (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∑–∞–∫—Ä—ã—Ç—ã—Ö –≥–ª–∞–∑ |
| **head_pose** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã (—Å–µ–∫) |
|  | `pitch` | –£–≥–æ–ª –Ω–∞–∫–ª–æ–Ω–∞ –≥–æ–ª–æ–≤—ã |
|  | `yaw` | –£–≥–æ–ª –ø–æ–≤–æ—Ä–æ—Ç–∞ –≥–æ–ª–æ–≤—ã |
| **no_belt** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è —Ä–µ–º–Ω—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ |
| **no_driver** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –≤–æ–¥–∏—Ç–µ–ª—è (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ |
| **no_face** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –æ—Ç—Å—É—Ç—Å—Ç–≤–∏—è –ª–∏—Ü–∞ (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ |
| **phone** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ |
| **yawn** | `duration` | –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –∑–µ–≤–æ—Ç—ã (—Å–µ–∫) |
|  | `threshold` | –ü–æ—Ä–æ–≥ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç–∏ –¥–µ—Ç–µ–∫—Ü–∏–∏ |
| **rockchip** | `ip` | IP –∞–¥—Ä–µ—Å Rockchip |
|  | `user` | –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å Rockchip |
|  | `password` | –ü–∞—Ä–æ–ª—å Rockchip |
|  | `config_path` | –ü—É—Ç—å –∫ –∫–æ–Ω—Ñ–∏–≥—É –Ω–∞ Rockchip |